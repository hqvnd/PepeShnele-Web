<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–û–±—ä—è–≤–ª–µ–Ω–∏—è - PepeShnele</title>
  <link rel="stylesheet" href="../css/style.css">
</head>
<body>
  <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
  <nav class="navbar">
    <div class="navbar-container">
      <a href="/frontend/index.html" class="navbar-brand">üé≠ PepeShnele</a>
      <button class="navbar-toggle">‚ò∞</button>
      <ul class="navbar-menu">
        <li><a href="/frontend/index.html" class="navbar-link">–ì–ª–∞–≤–Ω–∞—è</a></li>
        <li><a href="/frontend/pages/events.html" class="navbar-link">–°–æ–±—ã—Ç–∏—è</a></li>
        <li><a href="/frontend/pages/announcements.html" class="navbar-link active">–û–±—ä—è–≤–ª–µ–Ω–∏—è</a></li>
      </ul>
    </div>
  </nav>

  <!-- Header -->
  <section class="section-sm" style="background: var(--bg-primary);">
    <div class="container">
      <h1>–û–±—ä—è–≤–ª–µ–Ω–∏—è</h1>
      <p class="text-secondary">–í–∞–∂–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∏ –Ω–æ–≤–æ—Å—Ç–∏ –æ —Å–æ–±—ã—Ç–∏—è—Ö</p>
    </div>
  </section>

  <!-- –û–±—ä—è–≤–ª–µ–Ω–∏—è -->
  <section class="section">
    <div class="container-sm">
      <div id="announcementsContainer">
        <!-- –ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="footer">
    <div class="footer-content">
      <div class="footer-brand">üé≠ PepeShnele</div>
      <div class="footer-links">
        <a href="/frontend/index.html" class="footer-link">–ì–ª–∞–≤–Ω–∞—è</a>
        <a href="/frontend/pages/events.html" class="footer-link">–°–æ–±—ã—Ç–∏—è</a>
        <a href="/frontend/pages/announcements.html" class="footer-link">–û–±—ä—è–≤–ª–µ–Ω–∏—è</a>
      </div>
      <div class="footer-bottom">¬© 2026 PepeShnele. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</div>
    </div>
  </footer>

  <script src="../js/utils.js"></script>
  <script src="../js/api.js"></script>
  <script src="../js/auth.js"></script>
  <script>
    async function loadAnnouncements() {
      const container = document.getElementById('announcementsContainer');
      showLoading(container);

      try {
        const response = await announcementsAPI.getAll();
        const announcements = response.data;

        if (announcements.length === 0) {
          showEmptyState(
            container,
            '–û–±—ä—è–≤–ª–µ–Ω–∏–π –ø–æ–∫–∞ –Ω–µ—Ç',
            '–°–ª–µ–¥–∏—Ç–µ –∑–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏'
          );
          return;
        }

        const currentUser = getCurrentUser();
        
        container.innerHTML = announcements.map(announcement => {
          const userLiked = currentUser && announcement.likes.some(like => like.user === currentUser.id);
          
          return `
            <div class="card mb-3">
              <div class="card-body">
                ${announcement.event ? `
                  <div class="mb-2">
                    <span class="badge badge-success">üì¢ –°–≤—è–∑–∞–Ω–æ —Å —Å–æ–±—ã—Ç–∏–µ–º</span>
                  </div>
                ` : ''}
                
                <h3 class="card-title">${announcement.title}</h3>
                <p class="card-text" style="white-space: pre-wrap;">${announcement.content}</p>
                
                ${announcement.event ? `
                  <div class="mt-2">
                    <a href="/frontend/pages/event-detail.html?id=${announcement.event._id}" class="text-primary">
                      ‚Üí –ü–µ—Ä–µ–π—Ç–∏ –∫ —Å–æ–±—ã—Ç–∏—é: ${announcement.event.title}
                    </a>
                  </div>
                ` : ''}

                <div class="flex justify-between items-center mt-3">
                  <div class="stats">
                    <span class="stat-item">üë§ ${announcement.createdBy.username}</span>
                    <span class="stat-item">${timeAgo(announcement.createdAt)}</span>
                  </div>
                  
                  ${isAuthenticated() ? `
                    <button 
                      onclick="toggleLike('${announcement._id}')" 
                      class="btn btn-sm ${userLiked ? 'btn-danger' : 'btn-outline'}"
                    >
                      ${userLiked ? '‚ù§Ô∏è' : 'ü§ç'} ${announcement.likes.length}
                    </button>
                  ` : `
                    <span class="stat-item">‚ù§Ô∏è ${announcement.likes.length}</span>
                  `}
                </div>
              </div>
            </div>
          `;
        }).join('');
      } catch (error) {
        showError(container, '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏–π: ' + error.message);
      }
    }

    async function toggleLike(announcementId) {
      try {
        await announcementsAPI.toggleLike(announcementId);
        loadAnnouncements();
      } catch (error) {
        showAlert('–û—à–∏–±–∫–∞: ' + error.message, 'error');
      }
    }

    document.addEventListener('DOMContentLoaded', loadAnnouncements);
  </script>
</body>
</html>
